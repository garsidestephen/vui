var vooi = function () { function e() { F("speechRecognitionService.startVui"), f(), X = !0, Y = !1, h() } function n() { H === !1 && K === !1 && (l(), ae.hide(), ce.fadeIn()) } function t() { ce.fadeOut() } function i() { se.hide(), ae.fadeIn() } function o() { return 1 == pe.desktopOnly ? $(window).width() > 960 : !0 } function c(e) { if (e && e.length > 0) { var n = 150 * e.length; ue.html(r(e)), se.fadeIn(), setTimeout(function () { se.fadeOut() }, n) } } function r(e) { return m(e) || k(e), e } function a() { ae.addClass("vui-awake") } function s() { ae.removeClass("vui-awake") } function l() { $("#vui-not-now").on("click", function () { d() }), $("#vui-enable").on("click", function () { u(), t(), i(), e() }), $("#vui-show-more-info").on("click", function () { re.slideToggle() }) } function u() { U(G, !0, 365), "true" == V(N) && (alert("Thank you for enabling Voo-i but we notice you have previously blocked access to the microphone for this website so you will need to re-enable it before Voo-i will work"), M(N)) } function d() { U(J, !0, pe.vuiCTADismissalPeriodInDays), t() } function f() { null == _ && (_ = new webkitSpeechRecognition, _.lang = "en-GB", _.continuous = !1, _.interimResults = !1, _.onstart = function () { P() }, _.onend = function () { D() }, _.onresult = function (e) { E(e) }, _.onerror = function (e) { A(e) }) } function h() { Z === !1 && (F("startRecognition"), Y = !1, _.start()) } function p() { Z = !0 } function v() { F("recognitionEnded"), Z = !1, X === !0 && Y === !1 && h() } function g() { _ && _.abort() } function w(e) { if (F("processResult"), X === !0 && Y === !1) { var n = e.results[e.results.length - 1][0].transcript; n && "" != n ? (n = R(n), c(n), F("processResult - recognised:" + n), ne === !0 ? m(n) : k(n) || (s(), S(n))) : F("processResult - nothing recognised:") } } function m(e) { e.trim() == pe.wakeWord && y() } function k(e) { return e.trim() == pe.sleepWord ? (b(), !0) : !1 } function b() { F("And Sleep - In Sleep Mode!"), M(j), ne = !0, s() } function y() { ne = !1, F("In full recognition mode - I am awake!"), U(j, !0, null), a() } function S(e) { if (I(e)) x(e); else if (pe.actions && pe.actions.length > 0) { for (var n = [], t = 0; t < pe.actions.length; t++) { var i = pe.actions[t]; i.contexturl && i.contexturl != he || n.push(i) } if (n.length > 0) { for (var o = e.split(" "), c = [], t = 0; t < n.length; t++) { var i = n[t]; if (i.phrases && i.phrases.length > 0) { for (var r = null != i.accuracypercentage ? i.accuracypercentage : pe.accuracyPercentage, s = 0, l = 0; l < i.phrases.length; l++) { for (var u = i.phrases[l].toLowerCase(), d = u.split(" "), f = 100 / d.length, h = 0, p = o.length; p > 0; p--) { var v = d.indexOf(o[p - 1]); v > -1 && (h += f, d.splice(v)) } h >= s && (s = h) } s > r - .1 && (i.contexturl && "" != i.contexturl && i.type && "click" == i.type && (s += 1), c.push({ highestAccuracy: s, index: t })) } } c.length > 0 && (c.reverse(), C(n[c[0].index])) } } a() } function I(e) { return e && e.length > 0 && null != de && null != fe && (e.startsWith("search site for ") || e.startsWith("search site ") || e.startsWith("search for ") || e.startsWith("site search for ") || e.startsWith("site search ")) } function x(e) { e = e.replace("search site for ", "").replace("search site ", "").replace("search for ", "").replace("site search for", "").replace("site search ", ""), de.val(e), fe.submit() } function R(e) { return e.replace("-", " ").replace(".", "").replace("'", "").toLowerCase() } function C(e) { if (e && e.type && e.intent) switch (e.type.toLowerCase()) { case "redirect": window.location.href = e.intent; break; case "click": if (0 == e.intent.indexOf(".")) { var n = document.getElementsByClassName(e.intent.replace(".", "")); n && n.length > 0 && n[0].click() } else if (0 == e.intent.indexOf("#")) { var t = document.getElementById(e.intent.replace("#", "")); t && t.click() } break; case "scrolldown": W(!0); break; case "scrollup": W(!1); break; case "pagetop": T(0); break; case "pagebottom": T(ie); break; case "back": window.history.back() } } function W(e) { var n = $(window).scrollTop(), t = 0; n >= 0 && (1 == e ? t = n + te / 2 : (t = n - te / 2, 0 > t && (t = 0)), T(t)) } function T(e) { e >= 0 && oe.animate({ scrollTop: e }, 1e3) } function O(e) { e && (null != e.wakeword ? pe.wakeWord = e.wakeword : pe.wakeWord, null != e.sleepword ? pe.sleepWord = e.sleepword : pe.sleepWord, null != e.accuracypercentage ? pe.accuracyPercentage = e.accuracypercentage : pe.accuracyPercentage, null != e.actions ? pe.actions = e.actions : pe.actions, null != e.desktoponly ? pe.desktopOnly = e.desktoponly : pe.desktopOnly, null != e.vuictadismissalperiodindays ? pe.vuiCTADismissalPeriodInDays = e.vuictadismissalperiodindays : pe.vuiCTADismissalPeriodInDays, null != e.autoEnabled ? pe.autoEnabled = e.autoEnabled : pe.autoEnabled, null != e.theme ? pe.theme = e.theme : pe.theme, null != e.brand ? pe.brand = e.brand : pe.brand, null != e.siteSearchFieldId ? pe.siteSearchFieldId = e.siteSearchFieldId : pe.siteSearchFieldId, pe.autoEnabled === !0 && B(), null != pe.siteSearchFieldId && (de = $("#" + pe.siteSearchFieldId), de.length > 0 && (fe = de.closest("form")))) } function P() { F("speechRecognitionService.onStart"), p() } function E(e) { F("speechRecognitionService.onResult"), w(e) } function D() { F("speechRecognitionService.onEnd"), v() } function A(e) { F("speechRecognitionService.onError"), "not-allowed" == e.error && (ge(), M(G), U(N, !0, 365)) } function F(e) { ee === !0 && console.log(e) } function B() { var e = $("a"), n = $("button"), t = 0; e.length > 0 && e.each(function () { var e = $(this); t += 1, L(e.text(), t, e) }), n.length > 0 && n.each(function () { var e = $(this); t += 1, L(e.text(), t, e) }) } function L(e, n, t) { if ("" != e && n > 0 && t) { var i = "vui-ae-" + n; t.addClass(i), pe.actions.push({ contexturl: he, type: "click", phrases: [e, "go to " + e, "goto " + e, "click " + e], intent: "." + i, accuracypercentage: pe.accuracyPercentage }) } } function U(e, n, t) { var i = ""; if (t) { var o = new Date; o.setTime(o.getTime() + 24 * t * 60 * 60 * 1e3), i = "expires=" + o.toUTCString() } document.cookie = e + "=" + n + ";" + i + ";path=/" } function V(e) { for (var n = e + "=", t = decodeURIComponent(document.cookie), i = t.split(";"), o = 0; o < i.length; o++) { for (var c = i[o]; " " == c.charAt(0) ;) c = c.substring(1); if (0 == c.indexOf(n)) return c.substring(n.length, c.length) } return "" } function M(e) { document.cookie = e + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;" } function q(e) { $.get("/vui/vooi.html", function (n) { $("body").append(n), $(".vui-cta--brand").text(pe.brand), $("#vui-information--wakeword").text(pe.wakeWord), $("#vui-information--sleepword").text(pe.sleepWord), oe = $("html, body"), ce = $("#vui-cta"), re = $("#vui-cta .vui-cta--information"), ae = $("#vui-controls"), se = $("#vui-controls .vui-speech-wrap"), le = $("#vui-controls .vui-equalizer"), ue = $("#vui-results"), e && e() }) } function z() { var e = "vui-theme-" + pe.theme; ce.addClass(e), ae.addClass(e) } var G = "vuienabled", J = "vuidismissed", N = "vuimicblocked", j = "vuiawake", H = "true" == V(G), K = "true" == V(J), Q = !1, X = !1, Y = !1, Z = !1, _ = (/Mobi/.test(navigator.userAgent), null), ee = !1, ne = !0, te = $(window).height(), ie = $(document).height(), oe = null, ce = null, re = null, ae = null, se = null, le = null, ue = null, de = null, fe = null, he = window.location.href.replace(window.location.origin, ""), pe = { brand: "this website", desktopOnly: !0, wakeWord: "help", sleepWord: "goodbye", vuiCTADismissalPeriodInDays: 0, accuracyPercentage: 50, actions: null, autoEnabled: !1, theme: "red", siteSearchFieldId: null }, ve = function (t) { if (Q = window.hasOwnProperty("webkitSpeechRecognition") || window.hasOwnProperty("SpeechRecognition"), O(t), o()) if (Q === !0 && H === !1 && K === !1) { var c = function () { z(), n() }; q(c) } else if (Q === !0 && H === !0) { var c = function () { z(), i(), "true" == V(j) ? y() : ne = !0, e() }; q(c) } }, ge = function () { F("speechRecognitionService.stop"), X = !1, Y = !1, Z = !1, g() }, we = function () { F("speechRecognitionService.pause"), Y = !0, Z = !1, g() }; return { Init: function (e) { ve(e) }, Stop: ge, Pause: we } }();